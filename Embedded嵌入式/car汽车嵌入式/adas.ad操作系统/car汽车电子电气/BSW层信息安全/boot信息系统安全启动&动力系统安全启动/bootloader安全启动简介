1.bootloader安全启动简介:
	通常在我们的认知中, 车辆是在拧钥匙或者按下启动按钮后启动的, 
	但是实际上车辆中的大部分ECU在你按下解锁和开车门的时候已经起来, 等候工作; 
	那还有其他的部分:
		* 车辆中的电控单元是怎么被唤醒
		* 新能源车中最重要高压系统是怎么上下电的

	虽然控制单元可以IG ON、网络唤醒或者其他方式唤醒, 
	不过就目前车辆上的ECU而言, 大多数是采用网络唤醒(tcp/ip 协议栈有支持网络唤醒的协议), 
	因为整车上有八九十个ECU, 采用硬线控制会使总成本和重量都增加, 而且通过网络控制更加灵活; 

	ps:
		低压系统 = 弱电系统 = 计算机系统(耗电量小, 一般不会关闭的)
		高压系统 = 强电系统 = 电车动力系统(耗电量大, 会关机)





2.整车上下电流程(低压系统, 计算机系统):
	通常的整车上下电流程如下: 
		当钥匙按下解锁键或打开车门或按下启动键时, 唤醒信号通过网关转发至整车控制器(VCU), 并将其唤醒, 
		VCU唤醒后控制低压继电器盒, 使其他ECU上电, 并通过发送网络管理将其ECU唤醒, 
		ECU启动并完成自检后, 如果没有问题, 则可以正常工作了, 然后在上高压电; 

	在低压下电过程中, 当启动键切换到OFF档, 首先进行将断开高压供电, 车辆各ECU开始陆陆续续停发网络管理报文, 
	然后停发应用报文, 进入休眠下电流程, 
	最后控制电源管理模块, 断开供电; 

	另外在车辆休眠时, 大部分ECU的低压常电都是通过低压继电器盒断开的, 保证车辆静置时暗电流小, 能量消耗最低, 尽量延长低压蓄电池亏电时间, 
	因为在车辆静置时, 低压蓄电池电量不能通过高压动力电池进行补充; 
	不过也有些ECU在静置时需要定期运行, 比如BMS就需要定期唤醒检查高压动力电池的状态; 

	ps:
		由于电车整车的信息系统基本上是不关机的, 而且会长时间待机, 
		因此, 电车整车的信息安全压力不小, BSW 信息技术主要关注这一方面;
		还有蓝牙钥匙, 手机钥匙, 多种信息安全ID 校验(甚至是刷脸认证开门), 等等;





3.高压系统上下电逻辑(这个是业务开发方向的, autosar 功能开发, 跟信息安全关系不大):
	在纯电车中, 高压系统上电下电, 是很重要的一环, 
	首先高压存在安全问题, 另外如果高压无法上电, 车辆是无法开动的(类似于传统车上, 发动机没有启动, 车辆动不了一样)

	高压系统上下电的上层控制单元是VCU, 它负责各个子系统的协调, 以及整车运行状态的管理; 
	除了管理高压系统上下电, 也负责根据加速踏板、档位、制动踏板等驾驶员的操作意图和动力电池的电量, 计算出所需的电机输出扭矩等参数, 从而保障车辆的正常形式, 
	另外也根据动力电池的电量、电池温度以及行车制动来实现不同等级的能量回收; 

	高压系统上下电需要满足的原则: 
		* 避免车辆出现非预期的加速、减速、转向等动作; 
		* 应避免因高压故障引起人员伤亡及设备损坏; 
		* 满足高压系统上下电性能要求; 

	高压上电功能需求主要包括: 
		* 钥匙上电
		* 直流/交流充电
		* 远程控制(例如远程打开空调)
	这三种场景仅仅是唤醒的方式不一样, 高压上电的逻辑和时序是差不多的; 
	对于整个上电过程, 通过会有时间要求, 比如要求1s内局域网内各ECU(通常包括VCU、DCDC、DCU、BMS等)应完成上电流程, 并进入工作模式; 

	高压上电流程: 
		在上电流程中, 首先是VCU被唤醒(钥匙唤醒、网络唤醒、或者充电cc信号硬线唤醒), 
		启动后发送请求闭合HVIL回路使能线和必要的12V低压继电器的CAN报文, 同时监控HVIL回路状态, 
		然后DCU、DC/DC、BMS被唤醒(VCU发送的网络管理报文或者IG ON信号唤醒)并进行自检, 监控HVIL回路状态, 
		对于BMS来说还需计算绝缘阻值, 确认绝缘是否正常, 无故障后进入待机模式(standby状态); 

		随后VCU请求BMS闭合主继电器, BMS则先后闭合主负继电器和预充继电器, 
		当检测到母线电压达到阈值后, 判断预充电成功, 然后闭合主正继电器, 并断开预充继电器, 到这则高压上电完成, 
		在VCU请求BMS闭合主继电器时, 同时也会请求DCU、DC/DC进入工作模式, 时序图如: ./car高压系统正常上电流程.png 所示; 



	为什么要预充呢? 
		对于低压系统来说, 例如平时用的电池或者是12V低压蓄电池, 是不需要开关, 直接拔电池不会有什么风险; 
		但对高压而言, 直接接电池是不行的, 有可能会产生较大的冲击, 烧坏功率器件; 
		预充是将预充电阻串联到高压回路中, 由预充电阻分掉一部分电压, 
		然后, 随着各ECU内的电容充电上来, 等到电压上升到某一阈值, 主正继电器闭合, 这样预充回路就完成了它的工作了; 



	高压系统下电:
		在正常下电流程中, 当检测到钥匙信号、硬线信号关闭或网络唤醒信号停发, VCU立即请求DCU离开工作模式, 并且功率器件迅速降低功率, 随后VCU请求DC/DC离开工作模式, 
		然后VCU在请求BMS断开继高压继电器, BMS完成响应后, VCU断开HVIL回路和低压继电器, 各节点进入下电休眠流程, 如下图:./car高压系统正常下电流程.png 所示; 

	紧急下高压电流程: 
		在正常上电状态下, 如果出现绝缘阻值低于阈值、高压互锁断开、IGBT过流等严重故障时, VCU会进行紧急下高压电流程, 
		首先VCU请求DC/DC脱离工作模式, DCU进入failure模式, 
		随后VCU请求BMS断开高压继电器, 并且断开HVIL回路, 
		随后 VCU 请求 IPU 进入紧急放电模式,  DCU在规定时间内完成余电泄放, 
		若钥匙为关闭状态, 则各节点进入休眠流程, 如下图:./car高压系统紧急下电流程.png 所示; 






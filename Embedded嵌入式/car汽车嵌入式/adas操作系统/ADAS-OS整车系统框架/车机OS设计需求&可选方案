#
# 1.车载OS 的设计需求分析
#
一辆汽车上存在着上百个控制器, 包括发动机、变速箱、电动机、ESP, 也包括中控大屏、车机系统、车道辅助等; 
根据被控对象的不同, 这些控制器大概可以分为两类: 
	1.汽车电子控制
		通过直接向执行机构(如电子阀门、继电器开关、执行马达等)发送指令, 以控制发动机、变速箱、动力电池等协同工作的系统; 
		这类系统对实时性的要求非常高, 而且一般都会有功能安全等级的需求; 
	2.车载电子设备
		例如仪表、中控、抬头显示(HUD)、流媒体后视镜等; 
		这类系统一般与用户体验相关, 不直接参与汽车行驶的控制决策, 对车辆行驶性能和安全影响较小; 

两类硬件对实时性的要求不一样, 通常需要两种操作系统来控制, 分别是实时操作系统(Real Time Operating System, RTOS)和分时操作系统(Time-sharing Operating System); 

举个例子: 
	对于安全气囊控制器来说, 由于这是与安全相关的关键功能, 极小的时间误差(太早或太迟)都会产生灾难性后果, 甚至导致人员伤亡, 所以必须使用实时操作系统;
	对于车载终端来说, 我们可能需要一边打电话, 一边进行实时导航, 所以使用分时操作系统; 





#
# 2.常见的操作系统
#
* 实时操作系统(车控系统):
	实时操作系统是指当外界事件或数据产生时, 能够接受并以足够快的速度予以处理, 
	其处理的结果又能在规定的时间之内来控制生产过程, 或者对处理系统作出快速响应, 并控制所有实时任务协调一致运行的操作系统; 
	常见的RTOS 有QNX、VxWorks、MontaVista 等; 

* 分时操作系统(座舱系统):
	分时操作系统是一种联机的多用户交互式的操作系统; 
	一般采用时间片轮转的方式使一台计算机为多个终端服务, 对每个用户能保证足够快的响应时间, 并提供交互会话能力; 
	常见的分时操作系统有Windows、iOS、Android 等;
	(wince/linux+qt 已经在2020 年之后渐渐退出市场, 目前主要的座舱系统基本上都是android)

* 硬件虚拟化技术Hypervisor:
	一辆汽车上众多硬件设备的应用场景不同, 对实时性的要求也不同, 所以往往需要使用多个操作系统来相互配合; 
	为了解决一套硬件安装多个操作系统的问题, 后来QNX 推出了Hypervisor硬件虚拟化技术, 以支持kvm/qemu 虚拟机;
	(linux 车控系统早就支持Hypervisor 虚拟化技术了, 无压力, 稳定可靠) 
	Hypervisor 虚拟化技术, 其实就是虚拟机, 和我们在电脑上使用的VMware、VirtualBox 是一个道理; 
	Hypervisor 的出现使得"多系统"的概念成为了可能, 只要资源足够, 我们就可以在控制器上安装多种不同种类、不同供应商的操作系统来满足上层功能的需求; 





#
# 3.市面上常见的车载OS 方案
#
从全球来看, 目前汽车底层操作系统(车载OS 母系统)的市场格局较为稳定, 主要玩家有三个, 分别是: 
	1) QNX
		QNX 是一款微内核、嵌入式、非开源、安全实时的操作系统; 
		QNX 内核小巧, 运行速度极快, 具有独特的微内核架构, 安全和稳定性很高, 是全球首款通过 ISO26262 ASIL-D 安全认证的实时操作系统, 常用于安全稳定性要求较高的数字仪表中; 
		QNX 市场份额超过 50%, 通用、奥迪、宝马、保时捷等国际大厂都在使用 QNX; 

	2) Linux
		Linux 是一款开源、功能更强大的操作系统; Linux 具有内核紧凑高效等特点, 可以充分发挥硬件的性能; 
		Linux 与 QNX 相比最大优势在于开源, 具有很强的定制开发灵活度; 我们通常说的「基于 Linux 开发新的操作系统」是指基于 Linux Kernel(内核)进一步集成中间件、桌面环境和部分应用软件; 
		Linux 功能较 QNX 更强大, 组件也更为复杂, 因此 Linux 常用于支持更多应用和接口的信息娱乐系统中; 
		AGL(Automotive Grade Linux)是一个协作性开源项目, 它将汽车制造商, 供应商和技术公司召集在一起, 以加速开发和采用针对互联汽车的完全开放的软件堆栈; 
		AGL 以 Linux 为核心, 正在从头开始开发一个开放平台, 该平台可以用作事实上的行业标准, 以实现新功能和新技术的快速开发; 
		AGL 早期主要为丰田、本田、日产等日系厂商, 随着 2019 年大众、现代汽车的加入, AGL 势力规模逐渐壮大; 截至 2020 年 3 月, 国内已有中国移动、上汽集团、德赛西威、中科创达等公司加入了 AGL, 成员总数超过 150 个;
		(凯迪拉克CUE系统便是基于Linux的定制化的车载操作系统, 无论是其系统稳定性, 还是用户体验, 都获得业界好评, 
		 当然, CUE背后的软件研发投入也是巨大的, 凯迪拉克是纯美资企业嘛, 美国软件程序员多牛人, 也不是没可能)

	3) Android
		Android 是由 Google 公司和开放手机联盟基于 Linux 开发的操作系统, 被称为基于 Linux 开发的最成功的产品之一; 
		Linux 应用生态最为丰富, 主要应用于移动设备; 
		Android 手机上的 APP 不需要经过大的修改就可以应用在车机上, 有利于国内互联网厂商切入汽车领域, 快速建立起车载软件生态; 

从车机功能划分, 一般有:
	* 智驾Soc: '车控系统+AI自动驾驶系统'的组合方案(qnx/linux)
	* 座舱Soc: 座舱系统方案(大概率是android, linux+qt/wince/freertos 都是老式座舱OS了, 2020 之后基本就都是android了)

	对于座舱域这类对功能安全和信息安全要求较低的控制器, 国内多是基于Android/AliOS 进行开发, 国外多是基于Linux 进行开发; 
	而对于有较高安全性和实时性要求的自动驾驶控制器, 目前一般基于Linux/QNX 进行开发; 





#
# 4.旧式车机os 方案Windos CE(渐渐退出市场ing)
#
[linux+qt 基本上也在退出市场, 这种系统基本上不能满足: '车控系统+座舱系统'的双系统划分的, 
 那就是老式的一体化系统格局, 基本上新式车机系统方案, 都是'车控系统+座舱系统'的格局了]

Windos CE(Windos Embedbed Compact)是微软Windows操作系统中的一员, 专为微型电脑及嵌入式设备开发的系统环境; 
Windos CE很早就进入国内市场, 由于微软在办公系统的领导地位, 早期被广泛运用于工业工控机领域; 
依托微软强大的软件研发能力, Windos CE除了具备炫酷的UI界面, 其稳定性也不错; 
相对于其他车载系统, Windos CE在国内的行业生态环境要好的多, 无论是所需硬件, 服务提供商, 还是研发人才, 成本都要低; 

而且早期如凯立德、四维图新等车载导航系统供应商, 都是基于Windos CE开发的, 在一段时期内, 无论是前装还是后装, Windos CE在国内车机系统都处于领导地位; 
但随着Android系统的崛起, 其免费开源, 开发简单, 平台拥有海量应用等优势, 加之触控技术及触摸屏等硬件的成熟, 成本不断降低, 追求更加丰富的操作体验的用户, 为后装Android车机系统市场带来了繁荣; 
而且随着智能汽车的到来, 大有取而代之之势; 
相对于Android系统的丰富体验, Windos CE就显得捉襟见肘; 
由于车机系统大部分应用场景是导航和音乐, 移动互联时代, 任何一部智能手机都能取代车机, 而获得更佳的用户体验; 
像高德这样专注导航的企业, 必然会把核心精力放在更大用户量, 更高频的移动互联网场景, 这里有更多机会和更大利润空间; 
Windos CE明显已经不能满足当前用户的需求, 为他们带来更多价值; 

2007年福特公司开始使用微软WEA为其专属打造的车载底层操作系统SYNC, 总计装载超过700万台福特车, 期间出错报告和用户投诉不断, 出于用户口碑压力, 
2014年底, 福特不得不弃用微软的WEA系统, 而重新选择使用黑莓的QNX; 

最近几年, 一些互联网公司推出了自己的车载系统, 但都算不上是底层系统, 像苹果公司的CarPlay, 谷歌的Android Auto, 百度的Carlife都是基于底层操作系统实现的车机互联协议, 
而阿里AliOS, 则更像是类似小米的MIUI系统, 是基于Android开发, 而Android是基于Linux的;

ps:
	旧式的车机系统, 对划分'车控系统+座舱系统'的格局, 没有需求, 也就是这种车机系统是写死的, 不能往里面安装新的app;
	新式的车机系统, 车控系统不能安装新的app, 但座舱系统可以, 可以轻松安装map 地图软件, 打车软件等android app;
	而且新式的车机系统, 基本都支持OTA 远程更新技术;





结语:
	新式的车机系统, 一般包括:
		* 车控操作系统
		* 座舱操作系统
	前者(车控操作系统)负责汽车驾驶相关功能, 目前正逐步向智能驾驶方向演变, 智能驾驶系统方面(内部集成kvm-linux 虚拟机, 跑AI 自动驾驶框架), 
	目前QNX则占据垄断地位, linux 也有不少市场份额(Strategy Analytics数据显示, 在车控自动驾驶操作系统市场, QNX占据75%的市场份额, 超过Linux);

	后者(座舱操作系统)用于人机交互和车载信息娱乐, 目前正逐步向打造"第三生活空间"的智能座舱方向进化, android 是国内厂商选择的主流方案; 

	qnx vs linux:
		QNX由黑莓公司提供, 采用微内核架构, 因内核小巧, 运行速度极快, 具有安全、可靠、稳定等特点, 常用于安全稳定性要求较高的数字仪表、智能驾驶系统中; 
		包括宝马、奥迪、福特等全球 200 多家车企都与之建立合作关系, 其车载系统也应用在了数千万辆汽车的中, 但QNX 为闭源系统, 开发难度大、应用生态系统较为薄弱; 

		Linux 具有内核紧凑高效等特点, 可以充分发挥硬件的性能, 常用于支持更多应用和接口的信息娱乐系统中;
		Linux 与 QNX 相比最大优势在于开源, 具有很强的定制开发灵活度; 
